cve-2010-2553

## 分析方法：基于HeapPage（页堆）的堆漏洞分析方法

windbg开启页堆命令行:

​	！gflag +hpa

windbg正常调试命令

​	g 运行

​	kb 5  显示调用栈中前五个函数以及他们的前三个参数.

​	ub  栈回溯    -----> ub iccvid!DllInstanceInit+0x6279	

dll 动态加载 调试方式：

​	OD/windbg   逐层加载  先加载dll  下断点  然后加载wmplayer.exe 程序 打开 poc.avi

​	windbg  命令：sxe ld：ModuleName

​	lmv 显示已加载模块的详细信息

​	lml  同时显示加载的符号信息

​	lmk 显示内核模块信息

​	lmu 显示用户模块信息

​	lmf  显示镜像路径

​	lmm 匹配模块名称

​	lmD 使用 DML 方式显示

​	bl 断点list

​	p 单步不入

​	dd data dword

​	!heap -p -a  查看堆信息

​	??  命令根据当前线程和进程上下文来对表达式中的符号进行求值 

​	？ 计算和显示一个表达式的值

## 漏洞成因：

| Frame Header |   \|Flag(1字节) \| CVID数据长度 (3字节)\| 编码帧宽度(2字节) \|编码帧高度(2字节) \| 编码条数量(2字节)\|    |
| :----------------------------------------------------------- | ---- |
| strip 1 Header     |    \|编码条ID(2字节)\| 编码条数据大小(2字节) \|顶部Y坐标(2字节)\|顶部X坐标(2字节)\|底部Y坐标(2字节)\|底部X坐标(2字节)\|    |
| Strip 1 CodeBooks  |   \|Chunk ID(2字节)\| ChunK 数据大小(2字节) \|ChunkS数据(n-4字节)\|Chunk ID(2字节)\|   |
| strip 2 Header                                               |      |
| Strip 2 CodeBooks                                            |      |
| strip 3 Header                                               |      |
| Strip 3 CodeBooks                                            |      |
|                                                              |      |


​	程序在处理Cinepak 压缩数据时  CVID数据长度大于0x20  编码条超过三个时，若编码条中Chunk ID 为0下100 的CVID Chunk>= 3个 ，同时每次循环曹祖是未解压的数据都超过0x16 那么复制时就会导致堆溢出，因为目标地址每次操作都会递增0x2000（首次为0），而其大小只有0x6000 循环递增三次就会导致堆溢出





