<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

<meta http-equiv="pragma" content="no-cache">
<meta http-equiv="cache-control" content="no-cache, must-revalidate">
<meta http-equiv="expires" content="0">
<meta name="format-detection" content="telephone=no">
<!-- <link type="text/css" href="css/reset.css" rel="stylesheet" /> -->
<link rel="icon" href="./favicon.ico" type="image/x-icon" />
<link rel="shortcut icon" href="./favicon.ico" type="image/x-icon" />
<link type="text/css" href="css/widget.css" rel="stylesheet" />

<link type="text/css" href="themes/green/css/style.css" rel="stylesheet" />

<!--[if lte IE 8]>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<link href="themes/green/css/ie.css" rel="stylesheet" type="text/css" />
<![endif]-->

<!--[if lte IE 7]>
<link href="themes/green/css/ie.css" rel="stylesheet" type="text/css" />
<![endif]-->

<!--[if lte IE 6]>
<link href="themes/green/css/ie.css" rel="stylesheet" type="text/css" />
<![endif]-->
<script>
if ((navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i))){
		if(screen.height>=1080)
			document.write('<meta name="viewport" content="width=device-width, initial-scale=2.0, minimum-scale=1.0, maximum-scale=3.0, target-densityDpi=device-dpi, user-scalable=yes">');
		else
			document.write('<meta name="viewport" content="width=device-width, initial-scale=0.5, minimum-scale=0.5, maximum-scale=3.0, target-densityDpi=device-dpi, user-scalable=yes">');
}
</script>
<title>Opening...</title>
</head>

<body>
<!--主界面-->
<div class="top" id="top-wrapper">
    <div class="top-bg">
        <div class="top-bg-l"></div>
        <!-- <div class="top-bg-r"></div> -->
    </div><!-- background -->
    <div class="top-header">
		<div class="top-header-wrap">
        	<h1 id="product-tag"></h1>
            <div class="top-nav" id="top-nav">
                <!-- 菜单需要考虑的问题：1、动态加载；2、字符由charset控制 -->
                <ul id="ul-nav">
                    <li class="fst">
                        <div class="nav-wrap">
                            <a class="nav" name="quick_setup" href="pages/frame/quick-setup.html">
                                <span></span>
                            </a>
                        </div>
                    </li>
                    <li>                    
                        <div class="nav-wrap">
                            <a id="settings_link" class="nav" name="setting" href="pages/frame/settings.html">
                                <span></span>
                            </a>
                        </div>
                    </li><!--<li><a class="nav" name="advanced" href="pages/frame/advanced.html">
                        <span></span>
                    </a></li>-->
                </ul><!-- <li class="separator"></li> -->
            </div><!-- top-nav -->
            
            <div id="top-control" class="top-control">
            	<!--<div id="lan-select" class="lan-select-container">
                    <select id="lan-select">
                        <option>English</option>
                        <option>中文</option>
                    </select>--><!-- lan-select -->
                <!--</div>-->
                <div class="lan-select-container">
                    <input id="lan-select" />
                </div>
                
                
             <!--    <a class="top-control-btn" id="top-control-led" href="javascript:void(0);" >
                    <span class="icon"></span>
                    <span class="text">LED</span>
                </a> -->
                <a class="top-control-btn hidden" id="top-control-sysmode" href="javascript:void(0);" >
                    <span class="icon"></span>
                    <span id="txt-sysmode" class="text"></span>
                </a>
                <a class="top-control-btn" id="top-control-logout" href="javascript:void(0);" >
                    <span class="icon"></span>
                    <span id="txt-logout" class="text"></span>
                </a>
                <a class="top-control-btn" id="top-control-reboot" href="javascript:void(0);" >
                    <span class="icon"></span>
                    <span id="txt-reboot" class="text"></span>
                </a>
            </div>
        </div>
    </div><!-- top-header -->
    
    <div class="top-main">
        <div class="top-main-wrap">
            <div class="top-content">
                <div class="top-content-wrap" id="top-content">
                </div>
            </div><!-- top-content -->
            
            <div class="top-footer-mask"></div>
            <div class="top-footer hidden">
                <div class="top-footer-wrap">
                    <span id="product-info">
                        <span id="firmware-version-title"></span>
                        <span id="firmware-version-content"></span>
                        <span id="hardware-version-title"></span>
                        <span id="hardware-version-content"></span>
                    </span>
                            
                    <span class="help-faq">
                        <a id="btn-faq" class="btn-faq" href="http://www.tp-link.com/en/Support/" target="_blank"></a>
						<a id="btn-app" class="btn-app" href="javascript:void(0);"></a>
                    </span>
                </div>
            </div><!-- top-footer -->
			
			<div class="qr-code-container hidden">
				<div class="qr-code-container-wrapper">
					<div class="qr-code">
						<span id="close-icon" class="close-icon"></span>
						<div class="characters-illustrate">
							<span id="characters-illustrate-title" class="characters-illustrate-title"></span>
							<span id="characters-illustrate-note" class="characters-illustrate-note"></span>
						</div>
						<span class="qr-code-picture"></span>
						<div class="app-download-place">
	                        <a class="apple-store" target="_blank" href="https://itunes.apple.com/us/app/tp-link-tether/id599496594?ls=1&mt=8"></a>
	                        <a class="google-play" target="_blank" href="https://play.google.com/store/apps/details?id=com.tplink.tether"></a>
						</div>
					</div>
					<div class="qr-code-container-delta"></div>
				</div>
			</div>
        </div>
		<div class="top-main-img"></div>
    </div>

</div><!-- top-wrapper -->

<!--遮蔽层-->
<div id="mask" class="mask"></div>
<!--loading-->
<div class="loading-container" id="loading-container">
    <div class="loading-container-wrap">
        <div class="loading-container-inner">
            <div class="loading-waiting-icon"></div>
        </div>
    </div>
</div>

<!-- 重启和登出的确认 -->
<div id="reboot_confirm_msg" class="hidden warning">
    <div id="reboot_confirm_qa">
        <h4 class="title">
            <span class="icon"></span>
            <span class="text" id="reboot-confirm-msg-text"></span>
        </h4>
    </div>

    <div id="loading_msg" class="reboot-loading-msg hidden">
        <p id="reboot_progressbar_text" class="reboot-progressbar-text"></p>
        <input id="reboot_loading_progressbar" />
    </div>
</div>

<!-- /////////////////////////////////////////////////////////////// -->
<div id="mode_choose_msg" class="hidden">
    <div class="reboot-confirm-qa">
        <h4 class="title">
            <span class="icon"></span>
            <span id="mode_choose_text" class="text mode-switch-text"></span>
        </h4>

        <div id="mode_reboot_content">
            <input id="mode_choose_input" name="mode" type="text" class=""/>
            <p id="ap_tips" class="mode-slt-p"></p>
            <p id="router_tips" class="mode-slt-p"></p>
            <p id="repeater_tips" class="mode-slt-p"></p>
        </div>
    </div>
</div>

<div id="mode_reboot_msg">
    <div id="mode_reboot_note_content">
        <p id="mode_reboot_note"></p>
    </div>
</div>

<div id="mode_fail_msg" class="warning hidden">
    <div id="mode_change_fail" class="">
        <h4 class="title">
            <span class="icon"></span>
            <span id="mode_fail_title" class="text"></span>
        </h4>
    </div>    
</div>

<div id="logout_confirm_msg" class="hidden warning">
    <div class="reboot-confirm-qa">
        <h4 class="title">
            <span class="icon"></span>
            <span class="text" id="logout_confirm_msg_text"></span>
        </h4>
    </div>
</div>

<!-- 提示用户设置登录名和密码 -->
<div id="reset-user-msg-container" class="hidden">
    <div id="reset-user-form">
        <!--<h4 id="reset-user-title" class="title title"></h4>-->
        <div class="reset-user-content">
            <input id="reset-user-new-username" name="new_acc" />
            <input id="reset-user-new-password" name="new_pwd" />
            <input id="reset-user-confirm-password" name="cfm_pwd" />
            <input id="reset-user-confirm-password-status" />
        </div>
        <button type="button" id="btn-reset-user"></button>
    </div>
</div>

<!--全局警告提示框-->
<div id="global-warning-msg" class="hidden warning">
    <h4 class="title">
        <span class="icon"></span>
        <span class="text" id="global-warning-text-perssion-denied"></span>
    </h4>
</div>

<!--
以下是js部分
-->



<!--  jquery框架加载  -->
<script type="text/javascript" src="js/libs/jquery.min.js"></script>
<script type="text/javascript" src="js/libs/jquery.scrollTo.min.js"></script>
<script type="text/javascript" src="js/libs/jquery.nicescroll.min.js"></script>
<!-- <script type="text/javascript" src="js/libs/jquery.json-2.4.min.js"></script> -->
<!-- <script type="text/javascript" src="js/libs/jquery.extend.js"></script> -->
<!-- <script type="text/javascript" src="js/libs/jquery.cookies.min.js"></script> -->

<!--  语言部分加载  -->

<!-- <script id="lan-js" type="text/javascript" src="locale/en_US/lan.js"></script>
<link id="lan-css" type="text/css" rel="stylesheet" href="locale/en_US/lan.css" /> -->

<script type="text/javascript" src="js/su/locale.js"></script>
<script type="text/javascript">
//<![CDATA[
    try{
			$.su.locale.setDefault();
		}catch(error){
        location.href = "./error.html";
    };
//]]>
</script>
<script type="text/javascript">
//<![CDATA[
    try{
        $.su.locale.URL_LAN_CHECK = "./data/lang.json";  //$.su.url("/locale?form=lang");
		$.su.locale.get();
    }catch(error){
        location.href = "./error.html";
    };
//]]>
</script>

<!--  引入框架代码， 最后需要统一到一个文件下面  -->
<!--<script type="text/javascript" src="js/su/su.full-min.js"></script>
<script type="text/javascript" src="js/libs/encrypt.js"></script>-->
<script type="text/javascript" src="js/su/su.js"></script>
<script type="text/javascript" src="js/libs/encrypt.js"></script>
<script type="text/javascript" src="js/libs/md5.js"></script>

<script type="text/javascript" src="js/su/data/proxy.js"></script>
<script type="text/javascript" src="js/su/data/store.js"></script>
<script type="text/javascript" src="js/su/data/treestore.js"></script>

<script type="text/javascript" src="js/su/widget/widget.js"></script>

<script type="text/javascript" src="js/su/widget/window/panel.js"></script>
<script type="text/javascript" src="js/su/widget/window/page.js"></script>
<script type="text/javascript" src="js/su/widget/window/wizard.js"></script>
<script type="text/javascript" src="js/su/widget/window/msg.js"></script>
<script type="text/javascript" src="js/su/widget/window/foldertree.js"></script>
<script type="text/javascript" src="js/su/widget/window/keyword.js"></script>

<script type="text/javascript" src="js/su/widget/grid/grid.js"></script>
<script type="text/javascript" src="js/su/widget/grid/editor.js"></script>
<script type="text/javascript" src="js/su/widget/grid/paging.js"></script>

<script type="text/javascript" src="js/su/widget/form/form.js"></script>
<script type="text/javascript" src="js/su/widget/form/fieldset.js"></script>
<script type="text/javascript" src="js/su/widget/form/combobox.js"></script>
<script type="text/javascript" src="js/su/widget/form/checkbox.js"></script>
<script type="text/javascript" src="js/su/widget/form/radio.js"></script>
<script type="text/javascript" src="js/su/widget/form/textbox.js"></script>
<script type="text/javascript" src="js/su/widget/form/textarea.js"></script>
<script type="text/javascript" src="js/su/widget/form/button.js"></script>
<script type="text/javascript" src="js/su/widget/form/time.js"></script>
<script type="text/javascript" src="js/su/widget/form/file.js"></script>
<script type="text/javascript" src="js/su/widget/form/buttongroup.js"></script>
<!-- <script type="text/javascript" src="js/su/widget/form/timepicker.js"></script> -->
<script type="text/javascript" src="js/su/widget/form/progressbar.js"></script>
<script type="text/javascript" src="js/su/widget/form/tip.js"></script>
<script type="text/javascript" src="js/su/widget/form/region.js"></script>
<script type="text/javascript" src="js/su/widget/form/password.js"></script>
<script type="text/javascript" src="js/su/widget/form/switch.js"></script>
<script type="text/javascript" src="js/su/widget/form/status.js"></script>

<div id="for_mode_style"></div>
<!--<style id="sys_mode" type="text/css">
</style>-->

<!--  运行时代码  -->
<script type="text/javascript">
//<![CDATA[
$(document).ready(function(e){

//用户登出url
var URL_LOGOUT = "./data/logout.json"; //"./data/login.json"
var URL_REBOOT = "./data/reboot.json"; //"./data/login.json"
var URL_LOCALE = "./data/locale.json";

var logoutProxy = new $.su.Proxy({
    url: URL_LOGOUT,
    autoLoad: false
});

var rebootProxy = new $.su.Proxy({
    url: URL_REBOOT,
    autoLoad: false
});

function transRegion(data){ 
	data = data.toString(); 
	var str = ''; 
	for(var i=0; i<data.length; i++){ 
		data[i] == '/'? str += '/' : str+=data.charCodeAt(i); 
	} 
	return str; 
}



//index页面初始化
/**********SRT*多语言选择框*SRT*********/
//注意：需要判断是否更改，否则不发送信息~
var lanSelectCombo = $("input#lan-select").combobox({
    cls: "top-lan-select",
    items: [
    ],
    fieldLabel: null
}).on("ev_click", function(e, vOld, vNew){
    //console.log(vOld, vNew)
    if (vOld[0] == vNew[0]){
        return;
    };
    $.su.locale.set(vNew[0], function(){
        lanSelectCombo.combobox("setValue", [$.su.locale.locale]);
    }, function(){
        lanSelectCombo.combobox("setValue", [$.su.locale.locale]);
    });
});
$("input[value=pt_BR]").next().next().css({"display":"block","width":"999px"});
$("input[value=es_LA]").next().next().css({"display":"block","width":"999px"});
document.title = $.su.locale.model;
$("h1#product-tag").text($.su.locale.model);

$("span#txt-sysmode").text($.su.CHAR.CONTROL.MODE);
$("span#txt-logout").text($.su.CHAR.CONTROL.LOGOUT);
$("span#txt-reboot").text($.su.CHAR.CONTROL.REBOOT);

$("span#firmware-version-title").html($.su.CHAR.INDEX.FIRMWARE_VERSION);
$("span#hardware-version-title").html($.su.CHAR.INDEX.HARDWARE_VERSION);
$("a#btn-faq").html($.su.CHAR.INDEX.HELP_SUPPORT);

$('span#mode_fail_title').html($.su.CHAR.INDEX.MODE_FAIL_TIP);

$.su.CHAR.SUPPORT = {
	BG_BG: 						"http://www.tp-link.com/en/Support/",
	CS_CZ: 						"http://cz.tp-link.com/Support/",
	DE_DE: 						"http://www.tp-link.de/Support",
	EN_US: 						"http://www.tp-link.com/en/Support/",
	ES_ES: 						"http://www.tp-link.es/Support/",
	FR_FR: 						"http://www.tp-link.fr/Support/",
	IT_IT: 						"http://www.tp-link.it/Support/",
	KO_KR: 						"http://www.tp-link.co.kr/Support/",
	NL_NL: 						"http://nl.tp-link.com/Support/",
	PL_PL: 						"http://www.tp-link.com.pl/Support/",
	PT_PT: 						"http://www.tp-link.pt/Support/",
	RO_RO: 						"http://www.tp-link.ro/Support/",
	RU_RU: 						"http://www.tp-linkru.com/Support/",
	SK_SK: 						"http://cz.tp-link.com/Support/",
	TH_TH: 						"http://www.tp-link.co.th/Support/",
	TR_TR: 						"http://www.tp-link.com.tr/Support/",
	UK_UA: 						"http://www.tp-link.ua/uk/Support/",
	VI_VN: 						"http://www.tp-link.vn/Support/",
	ZH_TW: 						"http://www.tp-link.tw/Support/",
	PT_BR: 						"http://www.tp-link.com.br/Support/",
	ES_LA: 						"http://www.tp-link.com/ar/Support/",
	JA_JP: 						"http://www.tp-link.jp/support.html"
}
var support_url = $.su.CHAR.SUPPORT[$.su.locale.locale.toUpperCase()] || "http://www.tp-link.com/en/Support/";
$("#btn-faq").attr("href",support_url);

if ($.su.locale.force){
    lanSelectCombo.combobox("hide");
}else{		
	var localeProxy = new $.su.Proxy({
		url: URL_LOCALE
	});
	localeProxy.read({}, function(data){
		var locale=[];
		for(var i=0;i<data.length;i++){
			locale[i]={};
			locale[i].value=data[i].value;
			locale[i].name=$.su.CHAR.LANGUAGE[data[i].name];
		};
		lanSelectCombo.combobox("loadData",locale).combobox("setValue", [$.su.locale.locale]);
	});
}
/**********END*多语言选择框*END*********/

/**********STR*用户登录信息*STR**********/
var rebootConfirmMsg = $("div#reboot_confirm_msg").msg({
    type: "confirm",
    global: true,
    cls: 'reboot-confirm-size',
    closeBtn: false,
    okHandler: function(e){
        $('div#reboot_confirm_qa').hide();
        $('div#loading_msg').show();
        rebootConfirmMsg.msg('hideButtons');
		$.su.app.runningModule.unload();
        rebootProxy.write();
        reboot_pro_bar.progressbar("reset").progressbar('animate',  0, 1, rebootTime*1000, function(){
            location.href = "http://tplinkrepeater.net";
        });
        
        return false;
	},
    cancelHandler: function(){
        rebootConfirmMsg.msg('hide');
    }
});

/*var rebootLoadingMsg = $("div#reboot-loading-msg").msg({
    type: "window",
    global: true
});*/

$('p#ap_tips').html($.su.CHAR.INDEX.ACCESS_POINT_TIPS);
$('p#router_tips').html($.su.CHAR.INDEX.ROUTER_TIPS);
$('p#repeater_tips').html($.su.CHAR.INDEX.REPEATER_TIPS);
$('span#mode_choose_text').html($.su.CHAR.INDEX.MODE_SWITCH);
$('p#mode_reboot_note').html($.su.CHAR.INDEX.MODE_REBOOT_TIP);

var sysMode = '';
var rebootTime = 0;

var modeProxy = new $.su.Proxy({
    url: './data/sysmode.json'
});

var modeSltMsg = $("div#mode_choose_msg").msg({
    type: "confirm",
    global: true,
    closeBtn: false,
    cls: "l",
    yesText: $.su.CHAR.OPERATION.SAVE,
    noText: $.su.CHAR.OPERATION.CANCEL,
    okHandler: function(e){
        var modePara = $('input#mode_choose_input').radio('getValue');

        if(sysMode.toUpperCase() != modePara.toUpperCase()){
            modeRebootMsg.msg('show');
        }
    },
	noHandler:function(e){
		setTimeout(function(){
			$('input#mode_choose_input').radio('setValue',sysMode)
		},500);
	}
});

var sysModeRadio = $('input#mode_choose_input').radio({
    fieldLabel: null
});

modeProxy.read({}, function(data){
    sysMode = data.mode;
	window.repeater_type = data.repeater_type;
    rebootTime = data.pro_reboot_time;

    if(data.show5gFlag&&data.show5gFlag.toString()=='true'){
        $('div#for_mode_style').html('<style id="sys_mode" type="text/css"> .hidden_5g{display:inline; vertical-align:top;} </style>');
    }

    switch(data.support){
        case '1':
            $('a#top-control-sysmode').addClass('hidden');
            $('input#mode_choose_input').radio('loadData', [{boxlabel: $.su.CHAR.INDEX.REPEATER, inputValue: 'repeater', id:'repeater', name:'mode', content:'#repeater_tips'}]);
            $('#router_tips').addClass('hidden');
            $('#repeater_tips').addClass('hidden');
            break;
        case '3':
            $('a#top-control-sysmode').removeClass('hidden');
            $('input#mode_choose_input').radio('loadData', [
                {boxlabel: $.su.CHAR.INDEX.REPEATER, inputValue: 'repeater', id:'repeater', name:'mode', content:'#repeater_tips'},
                {boxlabel: $.su.CHAR.INDEX.ACCESS_POINT, inputValue:'ap', id:'ap', name:'mode', content:'#ap_tips'}
            ]);
            $('#router_tips').addClass('hidden');
            $('input#mode_choose_input').radio('setValue', data.mode);
            break;
        case '7':
            $('a#top-control-sysmode').removeClass('hidden');
            $('input#mode_choose_input').radio('loadData', [
                {boxlabel: $.su.CHAR.INDEX.ACCESS_POINT, inputValue:'ap', id:'ap', name:'mode', content:'#ap_tips'},
                {boxlabel: $.su.CHAR.INDEX.ROUTER, inputValue: 'router', id:'router', name:'mode', content:'#router_tips'},
                {boxlabel: $.su.CHAR.INDEX.REPEATER, inputValue: 'repeater', id:'repeater', name:'mode', content:'#repeater_tips'}
            ]);
            $('input#mode_choose_input').radio('setValue', data.mode);
            break;
    }
});

var modeFailMsg = $("div#mode_fail_msg").msg({
    type: "alert",
    global: true,
    closeBtn: false,
    cls: "l"
});

var modeRebootMsg = $("div#mode_reboot_msg").msg({
    type: "confirm",
    global: true,
    closeBtn: false,
    cls: "l",
    // yesText: $.su.CHAR.OPERATION.SAVE,
    // noText: $.su.CHAR.OPERATION.CANCEL,
    okHandler: function(e){

		$.su.app.runningModule.unload();
        modeProxy.write({mode: $('input#mode_choose_input').radio('getValue')}, function(data){
            $('div#reboot_confirm_qa').hide();
            $('div#loading_msg').show();
            rebootConfirmMsg.msg('hideButtons');
            
            rebootConfirmMsg.msg("show");

            // rebootProxy.write();
            reboot_pro_bar.progressbar("reset").progressbar('animate',  0, 1, rebootTime*1000, function(){
                if (localStorage){
                    localStorage.setItem("token", "");
                };

                if(data.mode=='router'){
                    location.href = 'http://tplinkwifi.net';
                }else{
                    location.href = 'http://tplinkrepeater.net';
                }
            });            

        }, function(){
            modeFailMsg.msg('show');
            // $('div#mode_reboot_note_content').hide();
            $('div#mode_change_fail').show();
        }, function(){
            modeFailMsg.msg('show');
            // $('div#mode_reboot_note_content').hide();
            $('div#mode_change_fail').show();
        });
    },
	noHandler:function(e){
		setTimeout(function(){
			$('input#mode_choose_input').radio('setValue',sysMode)
		},500);
	}
});


var logoutConfirmMsg = $("div#logout_confirm_msg").msg({
    type: "confirm",
    global: true,
    closeBtn: false,
    cls: "reboot-confirm-size",
    okHandler: function(e){
        logoutProxy.write({}, function(){
            location.href = "/";
        });
	}
});

var reboot_pro_bar = $('input#reboot_loading_progressbar').progressbar({
    fieldLabel: null,
    width: 400,
    height: 6,
    isProgressbar: true,
    cls: 'reboot-loading-probar'
});

$('span#reboot-confirm-msg-text').html($.su.CHAR.INDEX.CONFIRM_REBOOT);
$('p#reboot_progressbar_text').html($.su.CHAR.INDEX.REBOOTING);
$('span#logout_confirm_msg_text').html($.su.CHAR.INDEX.CONFIRM_LOGOUT);

$("a#top-control-sysmode").click(function(e){
    modeSltMsg.msg("show");
});

$("a#top-control-logout").click(function(e){
    logoutConfirmMsg.msg("show");
});

$("a#top-control-reboot").click(function(e){
    rebootConfirmMsg.msg("show");
});

/**********END*用户登录信息*END**********/

/**********SRT*警告信息*SRT**********/
$("span#global-warning-text-perssion-denied").html($.su.CHAR.ERROR["00000088"]);
var warningMsg = $("div#global-warning-msg").msg({
    type: "alert",
    global: true,
    cls: "m",
    closeBtn: false
});

/**********END*警告信息*END**********/

/**********SRT*软硬件版本信息*SRT*********/

var firmwareProxy = new $.su.Proxy({
    async: false,
    url: './data/firmware.set.json'
});

var firstLog = false;

firmwareProxy.read({}, function(data){
    var firmware = $("span#firmware-version-content");
    var hardware = $("span#hardware-version-content");
    if (data){
        if (data.firmware_version){
            firmware.html(data.firmware_version);
        }else{
            firmware.css("display", "none");
        };
        if (data.hardware_version){
            hardware.html(data.hardware_version);
        }else{
            hardware.css("display", "none");
        };
		if(data.region){
			firmware.html(firmware.html()+"("+transRegion(data.region)+")");
		}else{
		
		}
        if (data.is_default == true){
            firstLog = true;
        };

    }else{
        $("span#product-info").css("display", "none");
    };
}, function(){
    $("span#product-info").css("display", "none");
}, function(){
    $("span#product-info").css("display", "none");
});

/**********END*软硬件版本信息*END*********/

/**********STR*app定义*STR*********/
$.su.app = {
    /*runningModule: $({
        name: ""
    }),
    init: function(){
        $.su.app.runningModule.on("ev_unload", function(e, name){
            $.su.app.runningModule[0]["name"] = name;
            //console.log("ev_unload");
            $.su.app.runningModule.off("ev_beforeunload");
        });
    },*/
    runningModule: {
        name: "",
        addUnloadHandler: function(fn){
            if ($.isFunction(fn)){
                this.unloadHandlers.push(fn);
            }
        },
        clearUnloadHandler: function(){
            this.unloadHandlers = [];
        },
        unload: function(oldN, newN){
            this.name = newN;
            var handlers = this.unloadHandlers;
            for (var index in handlers){
                var fn = handlers[index];
                if ($.isFunction(fn)){
                    fn();
                }
            };
            this.clearUnloadHandler();
        },
        unloadHandlers: []
    },
    errorOperation: {
        denied: function(){
            $("div#global-warning-msg").msg("show");
        },
        userConflict: function(){
            //操作中用户冲突的回调
        }
    },
    navGoTo: function(name, url){
        var contentContainer = $("div#top-content");
        //旧模块卸载
        $.su.Manager.removeLocal();
        $.su.loading.show();

        /*if (name != "quick_setup"){
            //非quicksetup
            
            
            contentContainer.load(url, {}, function(response,status,xhr){
                $.su.layout.doLayout();
                $.su.loading.hide();
            });
        }else{*/
            //$.su.app.runningModule.trigger("ev_beforeunload", [$.su.app.runningModule[0].name, name]);
            var runningModule = $.su.app.runningModule;
                runningModule.unload(runningModule.name, name);

            contentContainer.load(url, {}, function(response,status,xhr){
                //$.su.app.runningModule.trigger("ev_unload", [name]);
                $.su.layout.doLayout();
				$(".top-footer").trigger("pageSwitch", [name]);
            //$.su.loading.hide();
            });
        //}
    },
    menuGoTo: function(name, url, isAdvanced){
        var contentContainer = isAdvanced ? $("div#func-advanced") : $("div#func-basic");
        //旧模块卸载
        $.su.Manager.removeLocal();
        //var runningModule = $.su.app.runningModule;
        //$.su.app.runningModule.trigger("ev_beforeunload", [$.su.app.runningModule[0].name, name]);
        //console.log("menuGoTo", runningModule)
        var runningModule = $.su.app.runningModule;
            runningModule.unload(runningModule.name, name);

        $.su.loading.show();
        contentContainer.load(url, {}, function(response,status,xhr){
            //$.su.app.runningModule.trigger("ev_unload", [name]);
            
            $.su.layout.doLayout();
            /*$("div.top-main").scrollTo({
                top: 0,
                left: 0
            }, 100);*/
            $("div.top-main").scrollTo(0);
			setTimeout(function(){
				$.su.loading.hide();
			},200);	//加载html结束后渲染或者执行js耗时
        });
    }   
};
//$.su.app.init();
/**********END*app定义*END*********/

/**********STR*菜单部分效果*STR**********/
$.su.nav = (function(){
	var nav = {};
	//字符串初始化
	var navItems = $("ul#ul-nav li a");
	navItems.each(function(index, element){
		var me = $(element),
			name = me.attr("name");
        me.html("<span>"+$.su.CHAR.NAV[name.toUpperCase()]+"</span>");
    });
	
	navItems.on("click", function(e){
		e.preventDefault();
		var me = $(this),
            name = me.attr("name");
		
		$.su.nav.goTo(name);
		
	});
	
	nav.goTo = function(name){
        var item = $("ul#ul-nav li a[name='"+name+"']");
        var url = item.attr("href");

        $("ul#ul-nav li").removeClass("selected");
        item.closest("li").addClass("selected");
        $.su.app.navGoTo(name, url);
	};
	
	return nav;
})();

if (firstLog){
    $.su.nav.goTo("quick_setup");
	$(".qr-code-container").removeClass("hidden");
    var resetUserMsg = $("div#reset-user-msg-container").msg({
        type: "window",
        global: true,
        title: $.su.CHAR.QUICK_SETUP.RESET_USER_TITLE,
        cls: "l reset-user"
    });

    //$("h4#reset-user-title").html($.su.CHAR.QUICK_SETUP.RESET_USER_TITLE);

    $("input#reset-user-new-username").textbox({
        fieldLabel: $.su.CHAR.QUICK_SETUP.NEW_USERNAME,
        autoTrim: false,
        vtype: {
            vtype: "ascii_visible",
            vtypeText: $.su.CHAR.VTYPETEXT.ACCOUNT
        },
        minLength:1,
        maxLength:15,
        allowBlank: false
    });
    setTimeout(function(){
        $("input#reset-user-new-username").focus();
    },10);

    var passwordCheck = function(new_pwd, cfm_val){
        
        if(cfm_val == new_pwd){
            resetUserConfirmPassword.password('setNormal');
            resetUserConfirmPasswordStatus.status("setSuccess");
            return true;
        }else{
            resetUserConfirmPasswordStatus.status("setFailed");
            return false;
        };
    };
    
    var resetUserNewPassword = $("input#reset-user-new-password").password({
        fieldLabel: $.su.CHAR.QUICK_SETUP.NEW_PASSWORD,
        showLevel: true,
        allowBlank: false,
        autoTrim: false,
        vtype: {
            vtype: "ascii_visible",
            vtypeText: $.su.CHAR.VTYPETEXT.PASSWORD
        },
        minLength:1,
        maxLength:15,
        encrypt: function(v){
            var r = $.su.md5(v);
            return r.toUpperCase();
        },
        encryptParam: []
    }).on("ev_change", function(){
        resetUserConfirmPasswordStatus.status('setNormal');
        resetUserConfirmPassword.password('setNormal');
        
        var new_pwd = resetUserNewPassword.password("getValue");
        var cfm_val = resetUserConfirmPassword.password("getValue");
        if ( cfm_val){
            passwordCheck(new_pwd, cfm_val);
        }
    }).on("ev_validatechange", function(){  
        
        var new_pwd = resetUserNewPassword.password("getValue");
        var cfm_val = resetUserConfirmPassword.password("getValue");

        if( cfm_val=='' ){
            resetUserConfirmPasswordStatus.status('setNormal');
            return true;
        }else{
            passwordCheck(new_pwd, cfm_val);
        };
    });

    var resetUserConfirmPassword = $("input#reset-user-confirm-password").password({
        fieldLabel: $.su.CHAR.QUICK_SETUP.CONFIRM_PASSWORD,
        showLevel: false,
        cls: "inline-block",
        allowBlank: false,
        autoTrim: false,
        vtype: {
            vtype: "ascii_visible",
            vtypeText: $.su.CHAR.VTYPETEXT.PASSWORD
        },
        minLength:1,
        maxLength:15,
        encrypt: function(v){
            var r = $.su.md5(v);
            return r.toUpperCase();
        },
        encryptParam: [],
    }).on("ev_validatechange", function(){
        var new_pwd = resetUserNewPassword.password("getValue");
        var cfm_val = resetUserConfirmPassword.password("getValue");
        if(new_pwd == '' || cfm_val == '')  return;
        
        if (!passwordCheck(new_pwd, cfm_val)){
            resetUserConfirmPassword.password("setError");
        };
    }).on("ev_change", function(e, value, key, keyCode){
        var new_pwd = resetUserNewPassword.password("getValue");
        var cfm_val = resetUserConfirmPassword.password("getValue");

        if ( cfm_val != "" ){
            if (new_pwd == ""){
                resetUserConfirmPasswordStatus.status("setNormal");
            }else{
                if (!passwordCheck(new_pwd, cfm_val)){
                    resetUserConfirmPassword.password("setError");
                }else{
                    resetUserConfirmPassword.password("setNormal");
                }
            }
        }

        if (key == "Enter" || keyCode == 13){
            resetUserForm.form("submit", {
                "operation": "set"
            }, function(){
                resetUserMsg.msg("close");
            });
        };

    });

    var resetUserConfirmPasswordStatus = $("input#reset-user-confirm-password-status").status({
        cls: "inline-block"
    });

    $("button#btn-reset-user").button({
        text: $.su.CHAR.QUICK_SETUP.CONFIRM,
        cls: "submit",
        handler: function(){
            $("input#reset-user-new-username").textbox('setNormal');
            $("input#reset-user-new-password").password('setNormal');
            $("input#reset-user-confirm-password").password('setNormal');
            resetUserForm.form("submit", {
                "operation": "set"
            }, function(){
                resetUserMsg.msg("close");
            });
        }
    });

    var resetUserForm = $("div#reset-user-form").form({
        proxy: {
            url: "./data/account.json"
        },
        autoLoad: false,
        fields: [
            {name: "new_acc", mapping: "new_acc"},
            {name: "new_pwd", mapping: "new_pwd"},
            {name: "cfm_pwd", mapping: "cfm_pwd"}
        ],
        submitBtn: "#btn-reset-user",
        validator: function(){
            var p1 = resetUserNewPassword.password("getValue");
            var p2 = resetUserConfirmPassword.password("getValue");
            if (p1 === p2){
                resetUserConfirmPasswordStatus.status("setSuccess");
                return true;
            }else{
                resetUserConfirmPassword.password("setError", $.su.CHAR.ERROR["00000080"]);
                return false;
            }
        }
    });

    //console.log("show resetUserMsg")
    var loginTypeProxy = new $.su.Proxy({
        url:"./data/login.type.json",
        async:false
    });

    loginTypeProxy.read({}, function(data){
        if(data.passwordOnly){
            resetUserMsg.msg("hide");
        }
        else{
            resetUserMsg.msg("show");
        } 
    });
}else{
    $.su.nav.goTo("setting");
    $("div#reset-user-msg-container").remove();
};
/**********END*菜单部分效果*END**********/

/**********SRT*布局调整*SRT*********/
$.su.layout.doLayout = function(){
	// if ($.su.app.runningModule.name === "quick_setup" || $.su.app.runningModule.name === "ap_quick_setup"){
	// 	var wh = $(window).height();
	// 	var ww = $(window).width();
	// 	var fh = 0;//$("div.top-footer").height();
	// 	var	hh = $("div.top-header").height();

	// 	var w = Math.max(ww, 980);
	// 	var pl = parseInt((w - 980)/2, 10);//padding-left;
	// 	var c = $("div#quicksetup-form");

	// 	var ch = $("div#top-content").height();
	// 	var h = ch;
	// 	var min_h = Math.max( wh - fh - hh,328);
	// 	if (fh+hh+ch >= wh){
	// 		c.css("height", h);
	// 	}else{
	// 		c.css("height", wh - hh - fh);
	// 	};
	// 	/*$("div#quicksetup-form").css({
	// 		"padding-left": pl,
	// 		"padding-right": pl
	// 	});*/
	setTimeout(function(){$("div.top-footer").removeClass("hidden");},1000);
		var wh = $(window).height();
		var	hh = $("div.top-header").height();
	var fh = $("div.top-footer").height();
	var ch = $("div#top-content").height();
	var mh = $("div.menu-container").height();


    var c = $("div.function-container");
    var pT = parseInt(c.css("paddingTop"), 10);
    var pB = parseInt(c.css("paddingBottom"), 10);

	$("div.content-container").css({
		"height": wh - hh
		});
	$("div.menu-container, div#quicksetup-form").css({
		"height": wh - hh - fh,
	});

    $("div.function-container").css({
		"height": wh - hh - fh - pT -pB,
    });

	// 	return;
	// };
        
	// var mh = $("div.menu-container").height(),
	// 	hh = $("div.top-header").height(),
	// 	fh = 0;//$("div.top-footer").height(),
	// 	wh = $(window).height(),
	// 	ww = $(window).width();

	// var th = $("div.top-main").height(),
	// 	ch = wh - hh - fh,
	// 	h = Math.max(mh, ch);
	// //var w = Math.max(ww, 980);
	// var w = Math.max(ww, 1032);

	// var c = $("div.function-container");
	// var pT = parseInt(c.css("paddingTop"), 10);
	// var pB = parseInt(c.css("paddingBottom"), 10);
	// //var pl = parseInt((w - 980)/2, 10);//padding-left;
	// var pl = parseInt((w - 1032)/2, 10);//padding-left;
	// var pr = pl + 50;//padding-right;
	// var func_ml = pl + 224;//func-container margin-left

	// $("div.menu-container").css({
	// 	//"min-height": h - pT -pB,
	// 	"height": wh - hh - fh,
	// 	// "padding-left": pl
	// });
	// $("div.function-container").css({
	// 	//"min-height": h - pT -pB,
	// 	"height": wh - hh - fh - pT -pB,
	// 	//"padding-right": pr,
	// 	// "padding-right": 50,
	// 	// "margin-left": func_ml
	// });
	$("div.help-container").css({
		"right": Math.min($("#top-content").offset().left,(document.body.clientWidth-$("#top-content").width())/2) + 15 + "px",
		"top": "23px"
	 	
	});
	if ((navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i))){
		//niceScroll导致不能滑动的bug
	}
	else{
		
		$("div#quicksetup-form").niceScroll({
			cursorcolor:"#9BDCEB",  
			cursoropacitymax:1,  
			touchbehavior:false,
			cursorwidth:"7px",  
			cursorborder:"1px",  
			cursorborderradius:"17px",
			enablescrollonselection:false
		});

		$("div.menu-container").niceScroll({
			cursorcolor:"#9BDCEB",  
			cursoropacitymax:1,  
			touchbehavior:false,  
			cursorwidth:"7px",  
			cursorborder:"1px",  
			cursorborderradius:"17px",
			enablescrollonselection:false
		});
	
		$("div.function-container").niceScroll({
			cursorcolor:"#9BDCEB",  
			cursoropacitymax:1,  
			touchbehavior:false,
			cursorwidth:"7px",  
			cursorborder:"1px",  
			cursorborderradius:"17px",
			enablescrollonselection:false
		});
	}
};
/**********END*布局调整*END*********/

/**********STR*二维码*STR**********/
$("a#btn-app").html($.su.CHAR.INDEX.HELP_APP);
$("span#characters-illustrate-title").html($.su.CHAR.INDEX.CHARACTERS_ILLUSTRETE_TITLE);
$("span#characters-illustrate-note").html($.su.CHAR.INDEX.CHARACTERS_ILLUSTRETE_NOTE0+" "+$.su.CHAR.INDEX.CHARACTERS_ILLUSTRETE_NOTE1);
$(".top-footer").on("pageSwitch", function(e, name){
	if(name=="quick_setup"){
		$("div.qr-code-container").addClass("quick-setup");
	}
	else{
		$("div.qr-code-container").removeClass("quick-setup");
	}
});
$("a#btn-app").click(function(){
	if($("div.qr-code-container").css("display") == "block"){
		$("div.qr-code-container").slideUp("2000");
	}
	else{
		$("div.qr-code-container").slideDown("2000");
	}
});
$("span#close-icon").click(function(){
	$("div.qr-code-container").slideUp("2000");
});
/**********END*二维码*END*********/

/**页面初始化**/
$(window).on("resize load", function(){
    $.su.layout.doLayout();
});

/////////////////////////////////////
var ledProxy = new $.su.Proxy({
        url: './data/led.json'
    });
$('a#top-control-led').click(function(){
    ledProxy.read({}, function(data){
        
    });
});


});
//]]>
</script>
</body>
</html>
